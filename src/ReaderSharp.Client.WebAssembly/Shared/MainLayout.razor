@inherits LayoutComponentBase
@inject IJSRuntime JsRuntime

<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    @if (_showAppBar)
    {
        <MudAppBar Elevation="0">
            <MudIconButton Icon="@Icons.Material.TwoTone.Menu" Edge="Edge.Start" OnClick="@((e) => ChangeNavMenuStatus())" />
            <MudSpacer />
            <MudIconButton Icon="@Icons.Material.TwoTone.Search" />
        </MudAppBar>
        <MudDrawer @bind-Open="_navMenuOpen" Elevation="1">
            <MudDrawerHeader>
                <MudText Typo="Typo.h6">ReaderSharp</MudText>
            </MudDrawerHeader>
            <NavMenu />
        </MudDrawer>
        <MudMainContent>
            <CascadingValue Value="this" Name="MainLayout">
                <MudContainer MaxWidth="MaxWidth.Large" Class="pt-4">
                    @Body
                </MudContainer>
            </CascadingValue>
        </MudMainContent>
    }
    else
    {
        <MudDrawer @bind-Open="_navMenuOpen" Elevation="1">
            <MudDrawerHeader>
                <MudText Typo="Typo.h6">ReaderSharp</MudText>
            </MudDrawerHeader>
            <NavMenu />
        </MudDrawer>
        <MudMainContent Class="@_mainContentClass">
            <CascadingValue Value="this" Name="MainLayout">
                <MudContainer MaxWidth="MaxWidth.Large" Class="pt-4">
                    @Body
                </MudContainer>
            </CascadingValue>
        </MudMainContent>
    }
</MudLayout>

@code
{
    private bool _showAppBar = true;
    private string _mainContentClass = "";

    public void HideAppBar()
    {
        _showAppBar = false;
        _mainContentClass = "pt-0";
        StateHasChanged();
    }

    public void ShowAppBar()
    {
        _showAppBar = true;
        _mainContentClass = "";
        StateHasChanged();
    }

    private bool _navMenuOpen = true;
    public void HideNavMenu()
    {
        _navMenuOpen = false;
        StateHasChanged();
    }

    public void ShowNavMenu()
    {
        _navMenuOpen = true;
        StateHasChanged();
    }

    private void ChangeNavMenuStatus()
    {
        if (_navMenuOpen)
        {
            HideNavMenu();
        }
        else
        {
            ShowNavMenu();
        }
    }

    public bool IsMobile { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        IsMobile = await JsRuntime.InvokeAsync<bool>("isDevice");
    }
}